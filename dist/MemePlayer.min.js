+function(){"use strict";function a(a){return/\.gif$/i.test(a)}function b(a){return"undefined"!=typeof a}function c(a){return"string"==typeof a}function d(a){var b=a.match(k);if(!b)throw new Error("[MemePlayer:nodatauri] Can't match url: "+a+" to regex: "+k);return b[2]}function e(a,b){var c,d=new XMLHttpRequest;d.open("GET",a,!0),d.responseType="arraybuffer",c=function(){b(new Error("[MemePlayer:network] A network error occurred."))},d.onload=function(){var a=d.response;d.status>=400?b(new Error("[MemePlayer:http] HTTP request returned "+d.status),a):b(null,a)
},d.onerror=d.onabort=c,d.send()}function f(b,c,d,f,g){var h;a(c)?e(c,function(a,c){if(a)g(a);else{var e,h,i,j=new GIF.Decoder(new Uint8Array(c)),k={frames:[]},l=j.numFrames();b.fillStyle="white",b.fillRect(0,0,d,f),l>0&&(e=b.createImageData(j.width,j.height),j.decodeAndBlitFrameRGBA(0,e.data),i=j.frameInfo(0),k.frames.push({delay:i.delay,frame:e}),h=e.data);for(var m=1;l>m;m++){e=b.createImageData(j.width,j.height);for(var n=0;n<e.data.length;n++)e.data[n]=h[n];j.decodeAndBlitFrameRGBA(m,e.data),i=j.frameInfo(m),k.frames.push({delay:i.delay,frame:e}),h=e.data
}g(null,k)}}):(h=new Image,h.crossOrigin="anonymous",h.addEventListener("load",function(){var a;b.fillStyle="white",b.fillRect(0,0,d,f),b.drawImage(h,0,0),a=b.getImageData(0,0,d,f),g(null,{frames:[{frame:a}]})}),h.src=c)}function g(a,b){var c,d,e,f,g,h,i,j,k,l=b.split(/\s+/);for(d=a.measureText(b),h=d.width,k=b,c=1;c<l.length;c++)i=l.slice(0,c).join(" "),d=a.measureText(i),e=d.width,j=l.slice(c).join(" "),d=a.measureText(j),f=d.width,g=Math.max(e,f),h>g&&(h=g,k=[i,j]);return{width:h,value:k}}function h(a,b,d){var e,f,h,i,j;
f={left:0,center:d.width/2,right:d.width},h={top:0,middle:d.height/2,bottom:d.height},i={top:0,middle:-30,bottom:-60},j={top:60,middle:30,bottom:0},e=function(b,e,k){var l,m,n;a.textAlign=e,a.textBaseline=k,l=a.measureText(b),m=Math.min(1,d.width/l.width),.5>=m&&(n=g(a,b),m=Math.min(1,d.width/n.width),b=n.value),a.save(),a.translate(f[e],h[k]),a.scale(m,m),c(b)?(a.fillText(b,0,0),a.strokeText(b,0,0)):(a.save(),a.translate(0,i[k]),a.fillText(b[0],0,0),a.strokeText(b[0],0,0),a.restore(),a.translate(0,j[k]),a.fillText(b[1],0,0),a.strokeText(b[1],0,0)),a.restore()
},a.font="60px Impact",a.fillStyle="white",a.strokeStyle="black",a.lineWidth=2,e(b.top.value,b.top.align,"top"),e(b.middle.value,b.middle.align,"middle"),e(b.bottom.value,b.bottom.align,"bottom")}function i(a,b,c,e,f){var g,i,j,k;e.frames.length>1?(j=0,g=new GIF.Encoder,g.setRepeat(0),g.start(),(k=function(){i=e.frames[j++],g.setDelay(10*i.delay),b.fillStyle="white",b.fillRect(0,0,i.frame.width,i.frame.height),b.putImageData(i.frame,0,0),h(b,c,i.frame),g.addFrame(b),j===e.frames.length?(g.finish(),f(null,{data:btoa(g.stream().getData()),contentType:"image/gif"})):setTimeout(k,0)
})()):(i=e.frames[0],b.fillStyle="white",b.fillRect(0,0,i.frame.width,i.frame.height),b.putImageData(i.frame,0,0),h(b,c,i.frame),f(null,{data:d(a.toDataURL("image/jpeg")),contentType:"image/jpeg"}))}function j(a,b,c){this.$$canvas=a,this.$$ctx=a.getContext("2d"),this.$$image=null,this.$$text={top:{value:"",align:"center"},middle:{value:"",align:"center"},bottom:{value:"",align:"center"}},this.$$width=b,this.$$height=c,a.setAttribute("width",b),a.setAttribute("height",c)}var k=/^data:(\w+\/\w+);base64,(.*)$/;
j.prototype.setWidth=function(a){this.$$width=a,this.$$canvas.setAttribute("width",a),this.$$redraw()},j.prototype.setHeight=function(a){this.$$height=a,this.$$canvas.setAttribute("height",a),this.$$redraw()},j.prototype.loadTemplate=function(a,b){f(this.$$ctx,a,this.$$width,this.$$height,function(a,c){a?b(a):(this.$$image=c,this.$$frameIndex=0,this.$$redraw(),b())}.bind(this))},j.prototype.$$redraw=function(){var a,c=this.$$ctx,d=this.$$image,e=this.$$text,f=this.$$timeout;d&&(a=d.frames[this.$$frameIndex].frame,f&&(clearTimeout(f),this.$$timeout=null),c.fillStyle="white",c.fillRect(0,0,a.width,a.height),c.putImageData(a,0,0),h(c,e,a),b(d.frames[this.$$frameIndex].delay)&&(this.$$timeout=setTimeout(function(){this.$$timeout=null,this.$$image&&(this.$$frameIndex=(this.$$frameIndex+1)%d.frames.length,this.$$redraw())
}.bind(this),10*d.frames[this.$$frameIndex].delay)))},j.prototype.setText=function(a){this.$$text.top.value=a.top.value||"",this.$$text.top.align=a.top.align||"center",this.$$text.middle.value=a.middle.value||"",this.$$text.middle.align=a.middle.align||"center",this.$$text.bottom.value=a.bottom.value||"",this.$$text.bottom.align=a.bottom.align||"center",this.$$redraw()},j.prototype.export=function(a){i(this.$$canvas,this.$$ctx,this.$$text,this.$$image,a)},window.MemePlayer=j}();