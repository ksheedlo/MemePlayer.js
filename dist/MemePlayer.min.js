+function(){"use strict";function t(t){return/\.gif$/i.test(t)}function e(t){return"undefined"!=typeof t}function a(t){var e=t.match(m);if(!e)throw new Error("[MemePlayer:nodatauri] Can't match url: "+dataUri+" to regex: "+m);return e[2]}function i(t,e){var a,i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="arraybuffer",a=function(){e(new Error("[MemePlayer:network] A network error occurred."))},i.onload=function(){var t=i.response;i.status>=400?e(new Error("[MemePlayer:http] HTTP request returned "+i.status),t):e(null,t)
},i.onerror=i.onabort=a}function r(e,a,r,n,l){t(a)?i(a,function(t){if(t)l(t);else{var a,i,o,s=new GIF.Decoder(new Uint8Array(res.data)),m={frames:[]},h=s.numFrames();e.fillStyle="white",e.fillRect(0,0,r,n),h>0&&(a=e.createImageData(s.width,s.height),s.decodeAndBlitFrameRGBA(0,a.data),o=s.frameInfo(0),m.frames.push({delay:o.delay,frame:a}),i=a.data);for(var d=1;h>d;d++){a=e.createImageData(s.width,s.height);for(var f=0;f<a.data.length;f++)a.data[f]=i[f];s.decodeAndBlitFrameRGBA(d,a.data),o=s.frameInfo(d),m.frames.push({delay:o.delay,frame:a}),i=a.data
}l(null,m)}}):(img=new $window.Image,img.crossOrigin="anonymous",img.addEventListener("load",function(){var t;e.fillStyle="white",e.fillRect(0,0,r,n),e.drawImage(img,0,0),t=e.getImageData(0,0,r,n),l(null,{frames:[{frame:t}]})}),img.src=a)}function n(t,e){var a,i,r,n,l,o,s,m,h,d=e.split(/\s+/);for(i=t.measureText(e),o=i.width,h=e,a=1;a<d.length;a++)s=d.slice(0,a).join(" "),i=t.measureText(s),r=i.width,m=d.slice(a).join(" "),i=t.measureText(m),n=i.width,l=Math.max(r,n),o>l&&(o=l,h=[s,m]);return{width:o,value:h}
}function l(t,e,a){var i,r,l,o,s;r={left:0,center:a.width/2,right:a.width},l={top:0,middle:a.height/2,bottom:a.height},o={top:0,middle:-30,bottom:-60},s={top:60,middle:30,bottom:0},i=function(e,i,m){var h,d,f;t.textAlign=i,t.textBaseline=m,h=t.measureText(e),d=Math.min(1,a.width/h.width),.5>=d&&(f=n(t,e),d=Math.min(1,a.width/f.width),e=f.value),t.save(),t.translate(r[i],l[m]),t.scale(d,d),angular.isString(e)?(t.fillText(e,0,0),t.strokeText(e,0,0)):(t.save(),t.translate(0,o[m]),t.fillText(e[0],0,0),t.strokeText(e[0],0,0),t.restore(),t.translate(0,s[m]),t.fillText(e[1],0,0),t.strokeText(e[1],0,0)),t.restore()
},t.font="60px Impact",t.fillStyle="white",t.strokeStyle="black",t.lineWidth=2,i(e.top.value,e.top.align,"top"),i(e.middle.value,e.middle.align,"middle"),i(e.bottom.value,e.bottom.align,"bottom")}function o(t,e,i,r,n){var o,s,m,h;r.frames.length>1?(m=0,o=new GIF.Encoder,o.setRepeat(0),o.start(),(h=function(){s=r.frames[m++],o.setDelay(10*s.delay),e.fillStyle="white",e.fillRect(0,0,s.frame.width,s.frame.height),e.putImageData(s.frame,0,0),l(e,i,s.frame),o.addFrame(e),m===r.frames.length?(o.finish(),n(null,{data:btoa(o.stream().getData()),contentType:"image/gif"})):setTimeout(h,0)
})()):(s=r.frames[0],e.fillStyle="white",e.fillRect(0,0,s.frame.width,s.frame.height),e.putImageData(s.frame,0,0),l(e,i,s.frame),n(null,{data:a(t.toDataURL("image/jpeg")),contentType:"image/jpeg"}))}function s(t,e,a){this.$$canvas=t,this.$$ctx=t.getContext("2d"),this.$$image=null,this.$$text={top:{value:"",align:"center"},middle:{value:"",align:"center"},bottom:{value:"",align:"center"}},this.$$width=e,this.$$height=a,t.setAttribute("width",e),t.setAttribute("height",a)}var m=/^data:(\w+\/\w+);base64,(.*)$/;
s.prototype.loadTemplate=function(t,e){r(this.$$ctx,t,this.$$width,this.$$height,function(t,a){t?e(t):(this.$$image=a,this.$$frameIndex=0,this.$$redraw(),e())}.bind(this))},s.prototype.$$redraw=function(){var t,a=this.$$ctx,i=this.$$image,r=this.$$text,n=this.$$timeout;i&&(t=i.frames[this.$$frameIndex].frame,n&&(clearTimeout(n),this.$$timeout=null),a.fillStyle="white",a.fillRect(0,0,t.width,t.height),a.putImageData(t,0,0),l(a,r,t),e(i.frames[frameIndex].delay)&&(this.$$timeout=setTimeout(function(){this.$$timeout=null,this.$$image&&(this.$$frameIndex=(this.$$frameIndex+1)%i.frames.length,this.$$redraw())
}.bind(this),10*i.frames[frameIndex].delay)))},s.prototype.setText=function(t){this.$$text.top.value=t.top.value||"",this.$$text.top.align=t.top.align||"center",this.$$text.middle.value=t.middle.value||"",this.$$text.middle.align=t.middle.align||"center",this.$$text.bottom.value=t.bottom.value||"",this.$$text.bottom.align=t.bottom.align||"center",this.$$redraw()},s.prototype.export=function(t){o(this.$$canvas,this.$$ctx,this.$$text,this.$$image,t)},window.MemePlayer=s}();